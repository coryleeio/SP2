#!/bin/bash

# This is mostly for easy dev setup
# bc no docker-compose in windows. x.x

export HOST=192.168.99.100
export SHARED_SERVER_SECRET=serverpotatoe

rm -rf ../login/common/*;
rm -rf ../game/common/*;
cp -R ../common/* ../login/common/
cp -R ../common/* ../game/common/

docker stop login  > /dev/null 2>/dev/null
docker stop client > /dev/null 2>/dev/null
docker stop game1  > /dev/null 2>/dev/null
docker stop game2  > /dev/null 2>/dev/null
docker stop game3  > /dev/null 2>/dev/null
docker stop mongo  > /dev/null 2>/dev/null
docker rm login  -f > /dev/null 2>/dev/null
docker rm client -f > /dev/null 2>/dev/null
docker rm game1  -f > /dev/null 2>/dev/null
docker rm game2  -f > /dev/null 2>/dev/null
docker rm game3  -f > /dev/null 2>/dev/null
docker rm mongo  -f > /dev/null 2>/dev/null
docker build -t client ../client/
docker build -t login ../login/
docker build -t game ../game/
docker build -t mongo ../mongodb/

docker run --name client \
-p 3000:3000 \
-d client

docker run --name mongo \
-p 27017:27017 \
-d mongo

docker run --name login \
-e SHARED_SERVER_SECRET=$SHARED_SERVER_SECRET \
-e SESSION_KEY=potatoesec \
--link mongo:mongo \
-p 80:80 \
-d login

docker run -e LOGIN_SERVER_HOST=$HOST -e LOGIN_SERVER_PORT=80 -e SHARED_SERVER_SECRET=$SHARED_SERVER_SECRET -e HOST=$HOST -e PORT=3001 --name game1 -p 3001:3000 -d game
docker run -e LOGIN_SERVER_HOST=$HOST -e LOGIN_SERVER_PORT=80 -e SHARED_SERVER_SECRET=$SHARED_SERVER_SECRET -e HOST=$HOST -e PORT=3002 --name game2 -p 3002:3000 -d game
docker run -e LOGIN_SERVER_HOST=$HOST -e LOGIN_SERVER_PORT=80 -e SHARED_SERVER_SECRET=$SHARED_SERVER_SECRET -e HOST=$HOST -e PORT=3003 --name game3 -p 3003:3000 -d game
docker ps