#!/bin/bash

# This is mostly for easy dev setup
# bc no docker-compose in windows. x.x
# (this is fixed now, will switch to compose soon.)

source ./creds
rm -rf ./game/app/app/_sharedClientSide
rm -rf ./login/app/app/js/_sharedClientSide
rm -rf ./game/app/_sharedServerSide
rm -rf ./login/app/_sharedServerSide
rm -rf ./login/app/app/public

mkdir ./game/app/app/_sharedClientSide  
mkdir ./login/app/app/js/_sharedClientSide  
mkdir ./game/app/_sharedServerSide  
mkdir ./login/app/_sharedServerSide  
mkdir ./login/app/app/public

cp -a ./common/sharedClientSide/. ./game/app/app/_sharedClientSide 
cp -a ./common/sharedClientSide/. ./login/app/app/js/_sharedClientSide 
cp -a ./common/sharedServerSide/. ./game/app/_sharedServerSide
cp -a ./common/sharedServerSide/. ./login/app/_sharedServerSide 
cp -a ./common/sharedClientSide/. ./login/app/app/public/

echo "SERVER_REGISTRATION_HOST=$(docker-machine ip default)" > ip
echo "HOST=$(docker-machine ip default)" >> ip

# Stop and remove any old containers
docker-compose stop
docker-compose rm -f
docker-compose build

# Remove common code.
# serverclient is shared between client and game servers
# serverside is shared between login and game servers

docker-compose up

# docker run \
# -e SERVER_REGISTRATION_HOST=192.168.99.100 \
# -e SESSION_KEY=potatosec \
# -e SERVER_REGISTRATION_PORT=80 \
# -e SHARED_SERVER_SECRET=serverpotatoe \
# -e HOST=192.168.99.100 \
# -e PORT=3001 \
# -e GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID \
# -e GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET \
# -e GOOGLE_CALLBACK_URL=$GOOGLE_CALLBACK_URL \
# --name game1 \
# -p 3001:3000 \
# --link mongo:mongo \
# -d game

# docker run \
# -e SERVER_REGISTRATION_HOST=192.168.99.100 \
# -e SESSION_KEY=potatosec \
# -e SERVER_REGISTRATION_PORT=80 \
# -e SHARED_SERVER_SECRET=serverpotatoe \
# -e HOST=192.168.99.100 \
# -e PORT=3002 \
# -e GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID \
# -e GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET \
# -e GOOGLE_CALLBACK_URL=$GOOGLE_CALLBACK_URL \
# --name game2 \
# -p 3002:3000 \
# --link mongo:mongo \
# -d game

# docker run \
# -e SERVER_REGISTRATION_HOST=192.168.99.100 \
# -e SESSION_KEY=potatosec \
# -e SERVER_REGISTRATION_PORT=80 \
# -e SHARED_SERVER_SECRET=serverpotatoe \
# -e HOST=192.168.99.100 \
# -e PORT=$3003 \
# -e GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID \
# -e GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET \
# -e GOOGLE_CALLBACK_URL=$GOOGLE_CALLBACK_URL \
# --name game3 \
# -p $3003:3000 \
# --link mongo:mongo \
# -d game